/*!
 * CanJS - 2.0.7
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Wed, 26 Mar 2014 16:12:27 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/view","can/view/elements"],function(can,elements){var newLine=/(\r|\n)+/g,clean=function(e){return e.split("\\").join("\\\\").split("\n").join("\\n").split('"').join('\\"').split("	").join("\\t")},getTag=function(e,t,n){if(e)return e;while(n<t.length){if(t[n]==="<"&&elements.reverseTagMap[t[n+1]])return elements.reverseTagMap[t[n+1]];n++}return""},bracketNum=function(e){return e.split("{").length-e.split("}").length},myEval=function(script){eval(script)},attrReg=/([^\s]+)[\s]*=[\s]*$/,startTxt="var ___v1ew = [];",finishTxt="return ___v1ew.join('')",put_cmd="___v1ew.push(\n",insert_cmd=put_cmd,htmlTag=null,quote=null,beforeQuote=null,rescan=null,getAttrName=function(){var e=beforeQuote.match(attrReg);return e&&e[1]},status=function(){return quote?"'"+getAttrName()+"'":htmlTag?1:0},top=function(e){return e[e.length-1]},automaticCustomElementCharacters=/[-\:]/,Scanner;return can.view.Scanner=Scanner=function(e){can.extend(this,{text:{},tokens:[]},e),this.text.options=this.text.options||"",this.tokenReg=[],this.tokenSimple={"<":"<",">":">",'"':'"',"'":"'"},this.tokenComplex=[],this.tokenMap={};for(var t=0,n;n=this.tokens[t];t++)n[2]?(this.tokenReg.push(n[2]),this.tokenComplex.push({abbr:n[1],re:new RegExp(n[2]),rescan:n[3]})):(this.tokenReg.push(n[1]),this.tokenSimple[n[1]]=n[0]),this.tokenMap[n[0]]=n[1];this.tokenReg=new RegExp("("+this.tokenReg.slice(0).concat(["<",">",'"',"'"]).join("|")+")","g")},Scanner.attributes={},Scanner.regExpAttributes={},Scanner.attribute=function(e,t){typeof e=="string"?Scanner.attributes[e]=t:Scanner.regExpAttributes[e]={match:e,callback:t}},Scanner.hookupAttributes=function(e,t){can.each(e&&e.attrs||[],function(n){e.attr=n,Scanner.attributes[n]?Scanner.attributes[n](e,t):can.each(Scanner.regExpAttributes,function(r){r.match.test(n)&&r.callback(e,t)})})},Scanner.tag=function(e,t){window.html5&&(window.html5.elements+=" "+e,window.html5.shivDocument()),Scanner.tags[e.toLowerCase()]=t},Scanner.tags={},Scanner.hookupTag=function(e){var t=can.view.getHooks();return can.view.hook(function(n){can.each(t,function(e){e(n)});var r=e.tagName,i=e.options.read("helpers._tags."+r,{isArgument:!0,proxyMethods:!1}).value,s=i||Scanner.tags[r],o=e.scope,u=s?s(n,e):o;if(u&&e.subtemplate){o!==u&&(o=o.add(u));var a=can.view.frag(e.subtemplate(o,e.options));can.appendChild(n,a)}can.view.Scanner.hookupAttributes(e,n)})},Scanner.prototype={helpers:[],scan:function(e,t){var n=[],r=0,i=this.tokenSimple,s=this.tokenComplex,o;e=e.replace(newLine,"\n"),this.transform&&(e=this.transform(e)),e.replace(this.tokenReg,function(t,o){var u=arguments[arguments.length-2];u>r&&n.push(e.substring(r,u));if(i[t])n.push(t);else for(var a=0,f;f=s[a];a++)if(f.re.test(t)){n.push(f.abbr),f.rescan&&n.push(f.rescan(o));break}r=u+o.length}),r<e.length&&n.push(e.substr(r));var u="",a=[startTxt+(this.text.start||"")],f=function(e,t){a.push(put_cmd,'"',clean(e),'"'+(t||"")+");")},l=[],c,h=null,p=!1,d={attributeHookups:[],tagHookups:[],lastTagHookup:""},v=function(){d.lastTagHookup=d.tagHookups.pop()+d.tagHookups.length},m="",g=[],y=!1,b,w=!1,E=0,S,x=this.tokenMap,T;htmlTag=quote=beforeQuote=null;for(;(S=n[E++])!==undefined;){if(h===null)switch(S){case x.left:case x.escapeLeft:case x.returnLeft:p=htmlTag&&1;case x.commentLeft:h=S,u.length&&f(u),u="";break;case x.escapeFull:p=htmlTag&&1,rescan=1,h=x.escapeLeft,u.length&&f(u),rescan=n[E++],u=rescan.content||rescan,rescan.before&&f(rescan.before),n.splice(E,0,x.right);break;case x.commentFull:break;case x.templateLeft:u+=x.left;break;case"<":n[E].indexOf("!--")!==0&&(htmlTag=1,p=0),u+=S;break;case">":htmlTag=0;var N=u.substr(u.length-1)==="/"||u.substr(u.length-2)==="--",C="";d.attributeHookups.length&&(C="attrs: ['"+d.attributeHookups.join("','")+"'], ",d.attributeHookups=[]);if(m+d.tagHookups.length!==d.lastTagHookup&&m===top(d.tagHookups))N&&(u=u.substr(0,u.length-1)),a.push(put_cmd,'"',clean(u),'"',",can.view.Scanner.hookupTag({tagName:'"+m+"',"+C+"scope: "+(this.text.scope||"this")+this.text.options),N?(a.push("}));"),u="/>",v()):n[E]==="<"&&n[E+1]==="/"+m?(a.push("}));"),u=S,v()):(a.push(",subtemplate: function("+this.text.argNames+"){\n"+startTxt+(this.text.start||"")),u="");else if(p||!y&&elements.tagToContentPropMap[g[g.length-1]]||C){var k=",can.view.pending({"+C+"scope: "+(this.text.scope||"this")+this.text.options+'}),"';N?f(u.substr(0,u.length-1),k+'/>"'):f(u,k+'>"'),u="",p=0}else u+=S;if(N||y)g.pop(),m=g[g.length-1],y=!1;d.attributeHookups=[];break;case"'":case'"':if(htmlTag)if(quote&&quote===S){quote=null;var L=getAttrName();Scanner.attributes[L]?d.attributeHookups.push(L):can.each(Scanner.regExpAttributes,function(e){e.match.test(L)&&d.attributeHookups.push(L)});if(w){u+=S,f(u),a.push(finishTxt,"}));\n"),u="",w=!1;break}}else if(quote===null){quote=S,beforeQuote=c,T=getAttrName();if(m==="img"&&T==="src"||T==="style"){f(u.replace(attrReg,"")),u="",w=!0,a.push(insert_cmd,"can.view.txt(2,'"+getTag(m,n,E)+"',"+status()+",this,function(){",startTxt),f(T+"="+S);break}};default:if(c==="<"){m=S.substr(0,3)==="!--"?"!--":S.split(/\s/)[0];var A=!1;m.indexOf("/")===0&&(A=!0,o=m.substr(1)),A?(top(g)===o&&(m=o,y=!0),top(d.tagHookups)===o&&(f(u.substr(0,u.length-1)),a.push(finishTxt+"}}) );"),u="><",v())):(m.lastIndexOf("/")===m.length-1&&(m=m.substr(0,m.length-1)),m!=="!--"&&(Scanner.tags[m]||automaticCustomElementCharacters.test(m))&&(m==="content"&&elements.tagMap[top(g)]&&(S=S.replace("content",elements.tagMap[top(g)])),d.tagHookups.push(m)),g.push(m))}u+=S}else switch(S){case x.right:case x.returnRight:switch(h){case x.left:b=bracketNum(u),b===1?(a.push(insert_cmd,"can.view.txt(0,'"+getTag(m,n,E)+"',"+status()+",this,function(){",startTxt,u),l.push({before:"",after:finishTxt+"}));\n"})):(r=l.length&&b===-1?l.pop():{after:";"},r.before&&a.push(r.before),a.push(u,";",r.after));break;case x.escapeLeft:case x.returnLeft:b=bracketNum(u),b&&l.push({before:finishTxt,after:"}));\n"});var O=h===x.escapeLeft?1:0,M={insert:insert_cmd,tagName:getTag(m,n,E),status:status(),specialAttribute:w};for(var _=0;_<this.helpers.length;_++){var D=this.helpers[_];if(D.name.test(u)){u=D.fn(u,M),D.name.source===/^>[\s]*\w*/.source&&(O=0);break}}typeof u=="object"?u.raw&&a.push(u.raw):w?a.push(insert_cmd,u,");"):a.push(insert_cmd,"can.view.txt(\n"+(typeof status()=="string"||O)+",\n'"+m+"',\n"+status()+",\n"+"this,\nfunction(){ "+(this.text.escape||"")+"return ",u,b?startTxt:"}));\n"),rescan&&rescan.after&&rescan.after.length&&(f(rescan.after.length),rescan=null)}h=null,u="";break;case x.templateLeft:u+=x.left;break;default:u+=S}c=S}u.length&&f(u),a.push(";");var P=a.join(""),H={out:(this.text.outStart||"")+P+" "+finishTxt+(this.text.outEnd||"")};return myEval.call(H,"this.fn = (function("+this.text.argNames+"){"+H.out+"});\r\n//# sourceURL="+t+".js"),H}},can.view.Scanner.tag("content",function(e,t){return t.scope}),Scanner});