/*!
 * CanJS - 2.0.7
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Wed, 26 Mar 2014 16:12:27 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library","can/view/scope","can/view","can/view/scanner","can/compute","can/view/render"],function(e){e.view.ext=".mustache";var t="scope",n="___h4sh",r="{scope:"+t+",options:options}",i=t+",options",s=/((([^\s]+?=)?('.*?'|".*?"))|.*?)\s/g,o=/^(('.*?'|".*?"|[0-9]+\.?[0-9]*|true|false|null|undefined)|((.+?)=(('.*?'|".*?"|[0-9]+\.?[0-9]*|true|false)|(.+))))$/,u=function(e){return'{get:"'+e.replace(/"/g,'\\"')+'"}'},a=function(e){return e&&typeof e.get=="string"},f=function(t){return t instanceof e.Map||t&&!!t._get},l=function(e){return e&&e.splice&&typeof e.length=="number"},c=function(t,n,r){return function(i,s){return i!==undefined&&!(i instanceof e.view.Scope)&&(i=n.add(i)),s!==undefined&&!(s instanceof v)&&(s=r.add(s)),t(i,s||r)}},h=function(t,n){if(this.constructor!==h){var r=new h(t);return function(e,t){return r.render(e,t)}}if(typeof t=="function"){this.template={fn:t};return}e.extend(this,t),this.template=this.scanner.scan(this.text,this.name)};e.Mustache=window.Mustache=h,h.prototype.render=function(t,n){return t instanceof e.view.Scope||(t=new e.view.Scope(t||{})),n instanceof v||(n=new v(n||{})),n=n||{},this.template.fn.call(t,t,n)},e.extend(h.prototype,{scanner:new e.view.Scanner({text:{start:"",scope:t,options:",options: options",argNames:i},tokens:[["returnLeft","{{{","{{[{&]"],["commentFull","{{!}}","^[\\s\\t]*{{!.+?}}\\n"],["commentLeft","{{!","(\\n[\\s\\t]*{{!|{{!)"],["escapeFull","{{}}","(^[\\s\\t]*{{[#/^][^}]+?}}\\n|\\n[\\s\\t]*{{[#/^][^}]+?}}\\n|\\n[\\s\\t]*{{[#/^][^}]+?}}$)",function(e){return{before:/^\n.+?\n$/.test(e)?"\n":"",content:e.match(/\{\{(.+?)\}\}/)[1]||""}}],["escapeLeft","{{"],["returnRight","}}}"],["right","}}"]],helpers:[{name:/^>[\s]*\w*/,fn:function(t,n){var r=e.trim(t.replace(/^>\s?/,"")).replace(/["|']/g,"");return"can.Mustache.renderPartial('"+r+"',"+i+")"}},{name:/^\s*data\s/,fn:function(e,n){var r=e.match(/["|'](.*)["|']/)[1];return"can.proxy(function(__){can.data(can.$(__),'"+r+"', this.attr('.')); }, "+t+")"}},{name:/\s*\(([\$\w]+)\)\s*->([^\n]*)/,fn:function(e){var n=/\s*\(([\$\w]+)\)\s*->([^\n]*)/,r=e.match(n);return"can.proxy(function(__){var "+r[1]+"=can.$(__);with("+t+".attr('.')){"+r[2]+"}}, this);"}},{name:/^.*$/,fn:function(t,a){var f=!1,l=[];t=e.trim(t);if(t.length&&(f=t.match(/^([#^/]|else$)/))){f=f[0];switch(f){case"#":case"^":a.specialAttribute?l.push(a.insert+"can.view.onlytxt(this,function(){ return "):l.push(a.insert+"can.view.txt(0,'"+a.tagName+"',"+a.status+",this,function(){ return ");break;case"/":return{raw:'return ___v1ew.join("");}}])}));'}}t=t.substring(1)}if(f!=="else"){var c=[],h=0,p;l.push("can.Mustache.txt(\n"+r+",\n"+(f?'"'+f+'"':"null")+",");var d=[];(e.trim(t)+" ").replace(s,function(e,t){h&&(p=t.match(o))?p[2]?c.push(p[0]):d.push(p[4]+":"+(p[6]?p[6]:u(p[5]))):c.push(u(t)),h++}),l.push(c.join(",")),d.length&&l.push(",{"+n+":{"+d.join(",")+"}}")}f&&f!=="else"&&l.push(",[\n\n");switch(f){case"#":l.push("{fn:function("+i+"){var ___v1ew = [];");break;case"else":l.push('return ___v1ew.join("");}},\n{inverse:function('+i+"){\nvar ___v1ew = [];");break;case"^":l.push("{inverse:function("+i+"){\nvar ___v1ew = [];");break;default:l.push(")")}return l=l.join(""),f?{raw:l}:l}}]})});var p=e.view.Scanner.prototype.helpers;for(var d=0;d<p.length;d++)h.prototype.scanner.helpers.unshift(p[d]);h.txt=function(t,r,i){var s=t.scope,o=t.options,u=[],p={fn:function(){},inverse:function(){}},d,v=s.attr("."),m=!0,g,y=!0,b=[],w,E,S;for(var x=3;x<arguments.length;x++){S=arguments[x];if(r&&e.isArray(S))p=e.extend.apply(e,[p].concat(S));else if(S&&S[n]){d=S[n];for(var T in d)a(d[T])&&(d[T]=h.get(d[T].get,t))}else S&&a(S)?u.push(h.get(S.get,t,!1,!0)):u.push(S)}if(a(i)){var N=i.get;i=h.get(i.get,t,u.length,!1),m=N===i}p.fn=c(p.fn,s,o),p.inverse=c(p.inverse,s,o);if(w=m&&typeof i=="string"&&h.getHelper(i,o)||e.isFunction(i)&&!i.isComputed&&{fn:i})return e.extend(p,{context:v,scope:s,contexts:s,hash:d}),u.push(p),w.fn.apply(v,u)||"";e.isFunction(i)&&i.isComputed&&(i=i()),g=u.length?u:[i];if(r)for(x=0;x<g.length;x++)S=g[x],E=typeof S!="undefined"&&f(S),l(S)?r==="#"?y=y&&(E?!!S.attr("length"):!!S.length):r==="^"&&(y=y&&(E?!S.attr("length"):!S.length)):y=r==="#"?y&&!!S:r==="^"?y&&!S:y;if(y)switch(r){case"#":if(l(i)){var C=f(i);for(x=0;x<i.length;x++)b.push(p.fn(i[x])),C&&i.attr(""+x);return b.join("")}return p.fn(i||{})||"";case"^":return p.inverse(i||{})||"";default:return""+(i!=null?i:"")}return""},h.get=function(t,n,r,i){var s=n.scope.attr("."),o=n.options||{};if(r){if(h.getHelper(t,o))return t;if(n.scope&&e.isFunction(s[t]))return s[t]}var u=n.scope.computeData(t,{isArgument:i,args:[s,n.scope]}),a=u.compute;e.compute.temporarilyBind(a);var f=u.initialValue;return f!==undefined&&u.scope===n.scope||!h.getHelper(t,o)?a.hasDependencies?a:f:t},h.resolve=function(t){return f(t)&&l(t)&&t.attr("length")?t:e.isFunction(t)?t():t};var v=e.view.Scope.extend({init:function(t,n){!t.helpers&&!t.partials&&(t={helpers:t}),e.view.Scope.prototype.init.apply(this,arguments)}});return h._helpers={},h.registerHelper=function(e,t){this._helpers[e]={name:e,fn:t}},h.getHelper=function(e,t){var n=t.attr("helpers."+e);return n?{fn:n}:this._helpers[e]},h.render=function(t,n,r){if(!e.view.cached[t]){var i=e.__clearReading&&e.__clearReading();n.attr("partial")&&(t=n.attr("partial")),e.__setReading&&e.__setReading(i)}return e.view.render(t,n)},h.safeString=function(e){return{toString:function(){return e}}},h.renderPartial=function(t,n,r){var i=r.attr("partials."+t);return i?i.render?i.render(n,r):i(n,r):e.Mustache.render(t,n,r)},e.each({"if":function(t,n){var r;return e.isFunction(t)?r=e.compute.truthy(t)():r=!!h.resolve(t),r?n.fn(n.contexts||this):n.inverse(n.contexts||this)},unless:function(e,t){if(!h.resolve(e))return t.fn(t.contexts||this)},each:function(t,n){var r=[],i,s,o,u=h.resolve(t);if(e.view.lists&&(u instanceof e.List||t&&t.isComputed&&u===undefined))return e.view.lists(t,function(e,t){return n.fn(n.scope.add({"@index":t}).add(e))});t=u;if(!!t&&l(t)){for(o=0;o<t.length;o++){var a=function(){return o};r.push(n.fn(n.scope.add({"@index":a}).add(t[o])))}return r.join("")}if(f(t)){i=e.Map.keys(t);for(o=0;o<i.length;o++)s=i[o],r.push(n.fn(n.scope.add({"@key":s}).add(t[s])));return r.join("")}if(t instanceof Object){for(s in t)r.push(n.fn(n.scope.add({"@key":s}).add(t[s])));return r.join("")}},"with":function(e,t){var n=e;e=h.resolve(e);if(!!e)return t.fn(n)},log:function(e,t){console!==undefined&&(t?console.log(e,t.context):console.log(e.context))}},function(e,t){h.registerHelper(t,e)}),e.view.register({suffix:"mustache",contentType:"x-mustache-template",script:function(e,t){return"can.Mustache(function("+i+") { "+(new h({text:t,name:e})).template.out+" })"},renderer:function(e,t){return h({text:t,name:e})}}),e});