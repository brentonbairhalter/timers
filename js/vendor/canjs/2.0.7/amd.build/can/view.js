/*!
 * CanJS - 2.0.7
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Wed, 26 Mar 2014 16:12:27 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library"],function(e){var t=e.isFunction,n=e.makeArray,r=1,i=e.view=e.template=function(n,r,s,o){t(s)&&(o=s,s=undefined);var u=function(e){return i.frag(e)},a=t(o)?function(e){o(u(e))}:null,f=t(n)?n(r,s,a):i.render(n,r,s,a),l=e.Deferred();return t(f)?f:e.isDeferred(f)?(f.then(function(e,t){l.resolve.call(l,u(e),t)},function(){l.fail.apply(l,arguments)}),l):u(f)};e.extend(i,{frag:function(e,t){return i.hookup(i.fragment(e),t)},fragment:function(t){var n=e.buildFragment(t,document.body);return n.childNodes.length||n.appendChild(document.createTextNode("")),n},toId:function(t){return e.map(t.toString().split(/\/|\./g),function(e){if(e)return e}).join("_")},hookup:function(t,n){var r=[],s,o;return e.each(t.childNodes?e.makeArray(t.childNodes):t,function(t){t.nodeType===1&&(r.push(t),r.push.apply(r,e.makeArray(t.getElementsByTagName("*"))))}),e.each(r,function(e){e.getAttribute&&(s=e.getAttribute("data-view-id"))&&(o=i.hookups[s])&&(o(e,n,s),delete i.hookups[s],e.removeAttribute("data-view-id"))}),t},hookups:{},hook:function(e){return i.hookups[++r]=e," data-view-id='"+r+"'"},cached:{},cachedRenderers:{},cache:!0,register:function(e){this.types["."+e.suffix]=e},types:{},ext:".ejs",registerScript:function(){},preload:function(){},render:function(r,s,f,l){t(f)&&(l=f,f=undefined);var c=u(s),h,p,d,v,m;if(c.length)return p=new e.Deferred,d=e.extend({},s),c.push(o(r,!0)),e.when.apply(e,c).then(function(t){var r=n(arguments),i=r.pop(),o;if(e.isDeferred(s))d=a(t);else for(var u in s)e.isDeferred(s[u])&&(d[u]=a(r.shift()));o=i(d,f),p.resolve(o,d),l&&l(o,d)},function(){p.reject.apply(p,arguments)}),p;e.__reading&&(h=e.__reading,e.__reading=null),v=t(l),p=o(r,v),e.Map&&h&&(e.__reading=h);if(v)m=p,p.then(function(e){l(s?e(s,f):e)});else{if(p.state()==="resolved"&&p.__view_id){var g=i.cachedRenderers[p.__view_id];return s?g(s,f):g}p.then(function(e){m=s?e(s,f):e})}return m},registerView:function(t,n,r,s){var o=(r||i.types[i.ext]).renderer(t,n);return s=s||new e.Deferred,i.cache&&(i.cached[t]=s,s.__view_id=t,i.cachedRenderers[t]=o),s.resolve(o)}});var s=function(e,t){if(!e.length)throw"can.view: No template or empty template:"+t},o=function(t,n){var r=typeof t=="string"?t:t.url,o=t.engine||r.match(/\.[\w\d]+$/),u,a,f;r.match(/^#/)&&(r=r.substr(1));if(a=document.getElementById(r))o="."+a.type.match(/\/(x\-)?(.+)/)[2];!o&&!i.cached[r]&&(r+=o=i.ext),e.isArray(o)&&(o=o[0]),f=i.toId(r),r.match(/^\/\//)&&(r=r.substr(2),r=window.steal?steal.config().root.mapJoin(""+steal.id(r)):r),window.require&&require.toUrl&&(r=require.toUrl(r)),u=i.types[o];if(i.cached[f])return i.cached[f];if(a)return i.registerView(f,a.innerHTML,u);var l=new e.Deferred;return e.ajax({async:n,url:r,dataType:"text",error:function(e){s("",r),l.reject(e)},success:function(e){s(e,r),i.registerView(f,e,u,l)}}),l},u=function(t){var n=[];if(e.isDeferred(t))return[t];for(var r in t)e.isDeferred(t[r])&&n.push(t[r]);return n},a=function(t){return e.isArray(t)&&t[1]==="success"?t[0]:t};return e.extend(i,{register:function(e){this.types["."+e.suffix]=e,i[e.suffix]=function(t,n){if(!n){var r=function(){return i.frag(r.render.apply(this,arguments))};return r.render=function(){var n=e.renderer(null,t);return n.apply(n,arguments)},r}return i.preload(t,e.renderer(t,n))}},registerScript:function(e,t,n){return"can.view.preload('"+t+"',"+i.types["."+e].script(t,n)+");"},preload:function(t,n){function s(){return i.frag(n.apply(this,arguments))}var r=i.cached[t]=(new e.Deferred).resolve(function(e,t){return n.call(e,e,t)});return s.render=n,r.__view_id=t,i.cachedRenderers[t]=n,s}}),e});