/*!
 * CanJS - 2.0.7
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Wed, 26 Mar 2014 16:12:27 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library","can/util/bind","can/util/batch"],function(e,t){var n=["__reading","__clearReading","__setReading"],r=function(t){var r={};for(var i=0;i<n.length;i++)r[n[i]]=e[n[i]];return e.__reading=function(e,n){t.push({obj:e,attr:n+""})},e.__clearReading=function(){return t.splice(0,t.length)},e.__setReading=function(e){[].splice.apply(t,[0,t.length].concat(e))},r},i=function(){},s=function(t,n){var i=[],s=r(i),o=t.call(n);return e.simpleExtend(e,s),{value:o,observed:i}},o=function(t,n,r,i){var o={},u=!0,a={value:undefined,teardown:function(){for(var e in o){var t=o[e];t.observe.obj.unbind(t.observe.attr,l),delete o[e]}}},f,l=function(e){if(i&&!i.bound)return;if(e.batchNum===undefined||e.batchNum!==f){var t=a.value,n=c();a.value=n,n!==t&&r(n,t),f=f=e.batchNum}},c=function(){var e=s(t,n),r=e.observed,i=e.value,a;u=!u;for(var f=0,c=r.length;f<c;f++)a=r[f],o[a.obj._cid+"|"+a.attr]?o[a.obj._cid+"|"+a.attr].matched=u:(o[a.obj._cid+"|"+a.attr]={matched:u,observe:a},a.obj.bind(a.attr,l));for(var h in o)a=o[h],a.matched!==u&&(a.observe.obj.unbind(a.observe.attr,l),delete o[h]);return i};return a.value=c(),a.isListening=!e.isEmptyObject(o),a},u=function(t){return t instanceof e.Map||t&&t.__get};e.compute=function(t,n,r){if(t&&t.isComputed)return t;var u,a,f={bound:!1,hasDependencies:!1},l=i,c=i,h,p=function(){return h},d=function(e){h=e},v=!0,m=e.makeArray(arguments),g=function(t,n){h=t,e.batch.trigger(a,"change",[t,n])},y;a=function(t){if(arguments.length){var r=h,i=d.call(n,t,r);return a.hasDependencies?p.call(n):(i===undefined?h=p.call(n):h=i,r!==h&&e.batch.trigger(a,"change",[h,r]),h)}return e.__reading&&v&&(e.__reading(a,"change"),f.bound||e.compute.temporarilyBind(a)),f.bound?h:p.call(n)};if(typeof t=="function")d=t,p=t,v=r===!1?!1:!0,a.hasDependencies=!1,l=function(e){u=o(t,n||this,e,f),a.hasDependencies=u.isListening,h=u.value},c=function(){u&&u.teardown()};else if(n)if(typeof n=="string"){var b=n,w=t instanceof e.Map;w&&(a.hasDependencies=!0),p=function(){return w?t.attr(b):t[b]},d=function(e){w?t.attr(b,e):t[b]=e};var E;l=function(n){E=function(){n(p(),h)},e.bind.call(t,r||b,E),h=s(p).value},c=function(){e.unbind.call(t,r||b,E)}}else if(typeof n=="function")h=t,d=n,n=r,y="setter";else{h=t;var S=n,x=g;g=function(){var e=p.call(n);e!==h&&x(e,h)},p=S.get||p,d=S.set||d,l=S.on||l,c=S.off||c}else h=t;return e.cid(a,"compute"),e.simpleExtend(a,{isComputed:!0,_bindsetup:function(){f.bound=!0;var t=e.__reading;delete e.__reading,l.call(this,g),e.__reading=t},_bindteardown:function(){c.call(this,g),f.bound=!1},bind:e.bindAndSetup,unbind:e.unbindAndTeardown,clone:function(t){return t&&(y==="setter"?m[2]=t:m[1]=t),e.compute.apply(e,m)}})};var a,f=function(){for(var e=0,t=a.length;e<t;e++)a[e].unbind("change",i);a=null};return e.compute.temporarilyBind=function(e){e.bind("change",i),a||(a=[],setTimeout(f,10)),a.push(e)},e.compute.binder=o,e.compute.truthy=function(t){return e.compute(function(){var e=t();return typeof e=="function"&&(e=e()),!!e})},e.compute.read=function(t,n,r){r=r||{};var i=t,s,o,a;for(var f=0,l=n.length;f<l;f++){o=i,o&&o.isComputed&&(r.foundObservable&&r.foundObservable(o,f),o=o()),u(o)?(!a&&r.foundObservable&&r.foundObservable(o,f),a=1,typeof o[n[f]]=="function"&&o.constructor.prototype[n[f]]===o[n[f]]?r.returnObserveMethods?i=i[n[f]]:n[f]==="constructor"&&o instanceof e.Construct?i=o[n[f]]:i=o[n[f]].apply(o,r.args||[]):i=i.attr(n[f])):i=o[n[f]],i&&i.isComputed&&!r.isArgument&&f<l-1&&(!a&&r.foundObservable&&r.foundObservable(o,f+1),i=i()),s=typeof i;if(f<n.length-1&&(i===null||s!=="function"&&s!=="object"))return r.earlyExit&&r.earlyExit(o,f,i),{value:undefined,parent:o}}return typeof i=="function"&&(r.isArgument?!i.isComputed&&r.proxyMethods!==!1&&(i=e.proxy(i,o)):(i.isComputed&&!a&&r.foundObservable&&r.foundObservable(i,f),i=i.call(o))),i===undefined&&r.earlyExit&&r.earlyExit(o,f-1),{value:i,parent:o}},e.compute});