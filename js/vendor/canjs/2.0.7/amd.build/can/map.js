/*!
 * CanJS - 2.0.7
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Wed, 26 Mar 2014 16:12:27 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library","can/util/bind","can/construct","can/util/batch"],function(e,t){var n=function(t,n,r){e.listenTo.call(r,t,"change",function(){var i=e.makeArray(arguments),s=i.shift();i[0]=(n==="*"?[r.indexOf(t),i[0]]:[n,i[0]]).join("."),s.triggeredNS=s.triggeredNS||{};if(s.triggeredNS[r._cid])return;s.triggeredNS[r._cid]=!0,e.trigger(r,s,i)})},r=function(t,n){return n?[t]:e.isArray(t)?t:(""+t).split(".")},i=function(e){return function(){var t=this;this._each(function(r,i){r&&r.bind&&n(r,e||i,t)})}},s=null,o=function(){for(var e in s)s[e].added&&delete s[e].obj._cid;s=null},u=function(e){return s&&s[e._cid]&&s[e._cid].instance},a=e.Map=e.Construct.extend({setup:function(){e.Construct.setup.apply(this,arguments);if(e.Map){this.defaults||(this.defaults={}),this._computes=[];for(var t in this.prototype)typeof this.prototype[t]!="function"?this.defaults[t]=this.prototype[t]:this.prototype[t].isComputed&&this._computes.push(t)}e.List&&!(this.prototype instanceof e.List)&&(this.List=a.List({Map:this},{}))},_computes:[],bind:e.bindAndSetup,on:e.bindAndSetup,unbind:e.unbindAndTeardown,off:e.unbindAndTeardown,id:"id",helpers:{addToMap:function(t,n){var r;s||(r=o,s={});var i=t._cid,u=e.cid(t);return s[u]||(s[u]={obj:t,instance:n,added:!i}),r},canMakeObserve:function(t){return t&&!e.isDeferred(t)&&(e.isArray(t)||e.isPlainObject(t)||t instanceof e.Map)},unhookup:function(t,n){return e.each(t,function(t){t&&t.unbind&&e.stopListening.call(n,t,"change")})},hookupBubble:function(t,r,i,s,o){return s=s||a,o=o||e.List,t instanceof a?i._bindings&&a.helpers.unhookup([t],i):e.isArray(t)?t=u(t)||new o(t):t=u(t)||new s(t),i._bindings&&n(t,r,i),t},serialize:function(t,n,r){return t.each(function(i,s){r[s]=a.helpers.canMakeObserve(i)&&e.isFunction(i[n])?i[n]():i,e.__reading&&e.__reading(t,s)}),e.__reading&&e.__reading(t,"__keys"),r},makeBindSetup:i},keys:function(t){var n=[];e.__reading&&e.__reading(t,"__keys");for(var r in t._data)n.push(r);return n}},{setup:function(t){this._data={},e.cid(this,".map"),this._init=1,this._setupComputes();var n=t&&e.Map.helpers.addToMap(t,this),r=e.extend(e.extend(!0,{},this.constructor.defaults||{}),t);this.attr(r),n&&n(),this.bind("change",e.proxy(this._changes,this)),delete this._init},_setupComputes:function(){var e=this.constructor._computes;this._computedBindings={};for(var t=0,n=e.length,r;t<n;t++)r=e[t],this[r]=this[r].clone(this),this._computedBindings[r]={count:0}},_bindsetup:i(),_bindteardown:function(){var e=this;this._each(function(t){a.helpers.unhookup([t],e)})},_changes:function(t,n,r,i,s){e.batch.trigger(this,{type:n,batchNum:t.batchNum},[i,s])},_triggerChange:function(t,n,r,i){e.batch.trigger(this,"change",e.makeArray(arguments))},_each:function(e){var t=this.__get();for(var n in t)t.hasOwnProperty(n)&&e(t[n],n)},attr:function(t,n){var r=typeof t;return r!=="string"&&r!=="number"?this._attrs(t,n):arguments.length===1?(e.__reading&&e.__reading(this,t),this._get(t)):(this._set(t,n),this)},each:function(){return e.__reading&&e.__reading(this,"__keys"),e.each.apply(undefined,[this.__get()].concat(e.makeArray(arguments)))},removeAttr:function(t){var n=e.List&&this instanceof e.List,i=r(t),s=i.shift(),o=n?this[s]:this._data[s];return i.length&&o?o.removeAttr(i):(!~t.indexOf(".")||(s=t),n?this.splice(s,1):s in this._data&&(delete this._data[s],s in this.constructor.prototype||delete this[s],e.batch.trigger(this,"__keys"),this._triggerChange(s,"remove",undefined,o)),o)},_get:function(e){var t;if(typeof e=="string"&&!!~e.indexOf(".")){t=this.__get(e);if(t!==undefined)return t}var n=r(e),i=this.__get(n.shift());return n.length?i?i._get(n):undefined:i},__get:function(t){return t?this[t]&&this[t].isComputed&&e.isFunction(this.constructor.prototype[t])?this[t]():this._data[t]:this._data},_set:function(e,t,n){var i=r(e,n),s=i.shift(),o=this.__get(s);if(i.length&&a.helpers.canMakeObserve(o))o._set(i,t);else{if(!!i.length)throw"can.Map: Object does not exist";this.__convert&&(t=this.__convert(s,t)),this.__set(s,t,o)}},__set:function(t,n,r){if(n!==r){var i=this.__get().hasOwnProperty(t)?"set":"add";this.___set(t,a.helpers.canMakeObserve(n)?a.helpers.hookupBubble(n,t,this):n),i==="add"&&e.batch.trigger(this,"__keys",undefined),this._triggerChange(t,i,n,r),r&&a.helpers.unhookup([r],this)}},___set:function(t,n){this[t]&&this[t].isComputed&&e.isFunction(this.constructor.prototype[t])&&this[t](n),this._data[t]=n,e.isFunction(this.constructor.prototype[t])||(this[t]=n)},bind:function(t,n){var r=this._computedBindings&&this._computedBindings[t];if(r)if(!r.count){r.count=1;var i=this;r.handler=function(n,r,s){e.batch.trigger(i,{type:t,batchNum:n.batchNum},[r,s])},this[t].bind("change",r.handler)}else r.count++;return e.bindAndSetup.apply(this,arguments)},unbind:function(t,n){var r=this._computedBindings&&this._computedBindings[t];return r&&(r.count===1?(r.count=0,this[t].unbind("change",r.handler),delete r.handler):r.count++),e.unbindAndTeardown.apply(this,arguments)},serialize:function(){return e.Map.helpers.serialize(this,"serialize",{})},_attrs:function(t,n){var r=this,i;if(t===undefined)return a.helpers.serialize(this,"attr",{});t=e.simpleExtend({},t),e.batch.start(),this.each(function(s,o){if(o==="_cid")return;i=t[o];if(i===undefined){n&&r.removeAttr(o);return}r.__convert&&(i=r.__convert(o,i)),i instanceof e.Map?r.__set(o,i,s):a.helpers.canMakeObserve(s)&&a.helpers.canMakeObserve(i)&&s.attr?s.attr(i,n):s!==i&&r.__set(o,i,s),delete t[o]});for(var s in t)s!=="_cid"&&(i=t[s],this._set(s,i,!0));return e.batch.stop(),this},compute:function(t){if(e.isFunction(this.constructor.prototype[t]))return e.compute(this[t],this);var n=t.split("."),r=n.length-1,i={args:[]};return e.compute(function(t){if(!arguments.length)return e.compute.read(this,n,i).value;e.compute.read(this,n.slice(0,r)).value.attr(n[r],t)},this)}});return a.prototype.on=a.prototype.bind,a.prototype.off=a.prototype.unbind,a});